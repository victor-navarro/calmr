<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>calmr_fits • calmr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="calmr_fits">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">calmr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/calmr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Model reference</h6></li>
    <li><a class="dropdown-item" href="../articles/model_parameters.html">Model Parameters</a></li>
    <li><a class="dropdown-item" href="../articles/RW1972.html">RW1972</a></li>
    <li><a class="dropdown-item" href="../articles/MAC1975.html">MAC1975</a></li>
    <li><a class="dropdown-item" href="../articles/PKH1982.html">PKH1982</a></li>
    <li><a class="dropdown-item" href="../articles/SM2007.html">SM2007</a></li>
    <li><a class="dropdown-item" href="../articles/HD2022.html">HD2022</a></li>
    <li><a class="dropdown-item" href="../articles/ANCCR.html">ANCCR</a></li>
    <li><a class="dropdown-item" href="../articles/TD.html">TD</a></li>
    <li><a class="dropdown-item" href="../articles/RAND.html">RAND</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Demos</h6></li>
    <li><a class="dropdown-item" href="../articles/calmr_app.html">calmr_app</a></li>
    <li><a class="dropdown-item" href="../articles/calmr_fits.html">calmr_fits</a></li>
    <li><a class="dropdown-item" href="../articles/parallelism_in_calmr.html">parallelism_in_calmr</a></li>
    <li><a class="dropdown-item" href="../articles/directional_models.html">directional_models</a></li>
    <li><a class="dropdown-item" href="../articles/using_time_models.html">using_time_models</a></li>
    <li><a class="dropdown-item" href="../articles/heidi_similarity.html">heidi_similarity</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/victor-navarro/calmr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>calmr_fits</h1>
                        <h4 data-toc-skip class="author">Victor
Navarro</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/victor-navarro/calmr/blob/v0.7.0/vignettes/calmr_fits.Rmd" class="external-link"><code>vignettes/calmr_fits.Rmd</code></a></small>
      <div class="d-none name"><code>calmr_fits.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/victor-navarro/calmr" class="external-link">calmr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pati</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="fitting-heidi-to-empirical-data">Fitting HeiDI to empirical data<a class="anchor" aria-label="anchor" href="#fitting-heidi-to-empirical-data"></a>
</h2>
<p>In this demo, I fit HeiDI to some empirical data (Patitucci et al.,
2016, Experiment 1). This will involve writing a function that produces
model responses organized as the empirical data, so we can use that
function for maximum likelihood estimation (MLE). We begin with a short
overview of the data, then move to the model function, and finally the
fit.</p>
<div class="section level3">
<h3 id="the-data">The data<a class="anchor" aria-label="anchor" href="#the-data"></a>
</h3>
<p>The data (<code>pati</code>) contains the responses (lever presses or
lp, and nose pokes or np) for 32 rats, across 6 blocks of training (2
sessions per block). The animals were trained to associate two levers to
two different food rewards (pellets or sucrose).</p>
<p>Let’s have a glance.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pati</span><span class="op">)</span></span>
<span><span class="co">#&gt;     subject        block     lever        us            response</span></span>
<span><span class="co">#&gt;  1      : 24   Min.   :1.0   B:  0   Length:768         lp:384  </span></span>
<span><span class="co">#&gt;  2      : 24   1st Qu.:2.0   L:384   Class :character   np:384  </span></span>
<span><span class="co">#&gt;  3      : 24   Median :3.5   R:384   Mode  :character           </span></span>
<span><span class="co">#&gt;  4      : 24   Mean   :3.5                                      </span></span>
<span><span class="co">#&gt;  5      : 24   3rd Qu.:5.0                                      </span></span>
<span><span class="co">#&gt;  6      : 24   Max.   :6.0                                      </span></span>
<span><span class="co">#&gt;  (Other):624                                                    </span></span>
<span><span class="co">#&gt;      rpert       </span></span>
<span><span class="co">#&gt;  Min.   :0.0000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.9437  </span></span>
<span><span class="co">#&gt;  Median :2.2500  </span></span>
<span><span class="co">#&gt;  Mean   :2.4806  </span></span>
<span><span class="co">#&gt;  3rd Qu.:3.8000  </span></span>
<span><span class="co">#&gt;  Max.   :8.4500  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="va">pati</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">block</span>, y <span class="op">=</span> <span class="va">rpert</span>, colour <span class="op">=</span> <span class="va">us</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">us</span>, <span class="va">subject</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"line"</span>, fun <span class="op">=</span> <span class="st">"mean"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Block"</span>, y <span class="op">=</span> <span class="st">"Responses per trial"</span>, colour <span class="op">=</span> <span class="st">"US"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">response</span><span class="op">)</span></span></code></pre></div>
<p><img src="calmr_fits_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<p>The thicker lines are group averages; the rest are individual
subjects. We ignore the specific mapping between levers and USs here
because that was counterbalanced across subjects. However, we will not
ignore the counterbalancing when writing the model function (see
ahead).</p>
</div>
<div class="section level3">
<h3 id="writing-the-model-function">Writing the model function<a class="anchor" aria-label="anchor" href="#writing-the-model-function"></a>
</h3>
<p>The biggest hurdle in fitting the model to empirical data is to write
a function that, <strong>given a vector of parameters and an experiment,
generates responses that are organized as the empirical data</strong>.
Let’s begin by summarizing the data first, so we know what to aim
for.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pati_summ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">pati</span><span class="op">)</span><span class="op">[</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"rpert"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rpert</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"block"</span>, <span class="st">"us"</span>, <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span><span class="co"># set order (relevant for the future)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">setorder</a></span><span class="op">(</span><span class="va">pati_summ</span>, <span class="va">block</span>, <span class="va">response</span>, <span class="va">us</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pati_summ</span><span class="op">)</span></span>
<span><span class="co">#&gt;    block     us response     rpert</span></span>
<span><span class="co">#&gt;    &lt;num&gt; &lt;char&gt;   &lt;fctr&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     1      P       lp 0.8195313</span></span>
<span><span class="co">#&gt; 2:     1      S       lp 0.5609375</span></span>
<span><span class="co">#&gt; 3:     1      P       np 3.4109375</span></span>
<span><span class="co">#&gt; 4:     1      S       np 3.2796875</span></span>
<span><span class="co">#&gt; 5:     2      P       lp 1.5738281</span></span>
<span><span class="co">#&gt; 6:     2      S       lp 0.6406250</span></span></code></pre></div>
<p>So what do we have to design? The experiment presented by Patitucci
et al. (2016) was fairly simple, and it can be reduced to the
presentations of two levers, each followed by a different appetitive
outcome. Here, we will assume that the two outcomes are independent from
each other. We will also take some liberties with the number of trials
we specify to reduce computing time.</p>
<p>But beware: HeiDI, like many learning models, is sensitive to order
effects. We do not want the model to misfit the data because we happened
to run our simulations with an unlucky run of trials. The arguments we
prepare must reflect the behavior of the model after a “general”
experimental procedure, and so, we address that issue by running several
iterations of the experiment (each with random order of trials) and
averaging all experiments before evaluating the likelihood of the
parameters.</p>
<p>With that in mind, we now will prepare the experiment as you would
pass to <code><a href="../reference/run_experiment.html">run_experiment()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The design data.frame</span></span>
<span><span class="va">des_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CB1"</span>, <span class="st">"CB2"</span><span class="op">)</span>,</span>
<span>  training <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"12L&gt;(Pellet)/12R&gt;(Sucrose)/12#L/12#R"</span>,</span>
<span>    <span class="st">"12L&gt;(Sucrose)/12R&gt;(Pellet)/12#L/12#R"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># The parameters</span></span>
<span><span class="co"># the actual parameter values don't matter,</span></span>
<span><span class="co"># as our function will re-write them inside the optimizer call</span></span>
<span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parameters.html">get_parameters</a></span><span class="op">(</span><span class="va">des_df</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"HD2022"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># The arguments</span></span>
<span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_experiment.html">make_experiment</a></span><span class="op">(</span><span class="va">des_df</span>,</span>
<span>  parameters <span class="op">=</span> <span class="va">parameters</span>, model <span class="op">=</span> <span class="st">"HD2022"</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span>
<span><span class="va">experiment</span></span></code></pre></div>
<p>Note we specified two counterbalancings as groups.</p>
<p>We must reproduce the counterbalancings in the data we are trying to
fit as close as possible. Otherwise, the optimization process might
latch onto experimentally-irrelevant variables. For example, it can be
seen in <code>pati</code> that there was more lever pressing whenever a
lever was paired with pellets. If we didn’t counterbalance the
identities of the levers and food rewards, the optimization might result
in one of the levers being less salient than the other!</p>
<p>We can now begin to write the model function. First, it would be a
good to see what results <code><a href="../reference/run_experiment.html">run_experiment()</a></code> returns.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/CalmrExperiment-methods.html">results</a></span><span class="op">(</span><span class="va">exp_res</span><span class="op">)</span></span>
<span><span class="co">#&gt; $activations</span></span>
<span><span class="co">#&gt;       group    phase  trial_type trial block_size      s1     value  model</span></span>
<span><span class="co">#&gt;      &lt;char&gt;   &lt;char&gt;      &lt;char&gt; &lt;int&gt;      &lt;num&gt;  &lt;fctr&gt;     &lt;num&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt;   1:    CB1 training  L&gt;(Pellet)     1          4       L 0.4000000 HD2022</span></span>
<span><span class="co">#&gt;   2:    CB1 training R&gt;(Sucrose)     2          4       L 0.0000000 HD2022</span></span>
<span><span class="co">#&gt;   3:    CB1 training          #L     3          4       L 0.4000000 HD2022</span></span>
<span><span class="co">#&gt;   4:    CB1 training          #R     4          4       L 0.0000000 HD2022</span></span>
<span><span class="co">#&gt;   5:    CB1 training  L&gt;(Pellet)     5          4       L 0.4000000 HD2022</span></span>
<span><span class="co">#&gt;  ---                                                                      </span></span>
<span><span class="co">#&gt; 380:    CB2 training          #R    44          4 Sucrose 0.0000000 HD2022</span></span>
<span><span class="co">#&gt; 381:    CB2 training L&gt;(Sucrose)    45          4 Sucrose 0.4000000 HD2022</span></span>
<span><span class="co">#&gt; 382:    CB2 training  R&gt;(Pellet)    46          4 Sucrose 0.0000000 HD2022</span></span>
<span><span class="co">#&gt; 383:    CB2 training          #L    47          4 Sucrose 0.3991293 HD2022</span></span>
<span><span class="co">#&gt; 384:    CB2 training          #R    48          4 Sucrose 0.0000000 HD2022</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $associations</span></span>
<span><span class="co">#&gt;        group    phase trial_type trial block_size      s1      s2     value</span></span>
<span><span class="co">#&gt;       &lt;char&gt;   &lt;char&gt;     &lt;char&gt; &lt;int&gt;      &lt;num&gt;  &lt;char&gt;  &lt;char&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:    CB1 training L&gt;(Pellet)     1          4       L       L 0.0000000</span></span>
<span><span class="co">#&gt;    2:    CB1 training L&gt;(Pellet)     1          4       L  Pellet 0.0000000</span></span>
<span><span class="co">#&gt;    3:    CB1 training L&gt;(Pellet)     1          4       L       R 0.0000000</span></span>
<span><span class="co">#&gt;    4:    CB1 training L&gt;(Pellet)     1          4       L Sucrose 0.0000000</span></span>
<span><span class="co">#&gt;    5:    CB1 training L&gt;(Pellet)     1          4  Pellet       L 0.0000000</span></span>
<span><span class="co">#&gt;   ---                                                                      </span></span>
<span><span class="co">#&gt; 1532:    CB2 training         #R    48          4       R Sucrose 0.0000000</span></span>
<span><span class="co">#&gt; 1533:    CB2 training         #R    48          4 Sucrose       L 0.3991293</span></span>
<span><span class="co">#&gt; 1534:    CB2 training         #R    48          4 Sucrose  Pellet 0.0000000</span></span>
<span><span class="co">#&gt; 1535:    CB2 training         #R    48          4 Sucrose       R 0.0000000</span></span>
<span><span class="co">#&gt; 1536:    CB2 training         #R    48          4 Sucrose Sucrose 0.0000000</span></span>
<span><span class="co">#&gt;        model</span></span>
<span><span class="co">#&gt;       &lt;char&gt;</span></span>
<span><span class="co">#&gt;    1: HD2022</span></span>
<span><span class="co">#&gt;    2: HD2022</span></span>
<span><span class="co">#&gt;    3: HD2022</span></span>
<span><span class="co">#&gt;    4: HD2022</span></span>
<span><span class="co">#&gt;    5: HD2022</span></span>
<span><span class="co">#&gt;   ---       </span></span>
<span><span class="co">#&gt; 1532: HD2022</span></span>
<span><span class="co">#&gt; 1533: HD2022</span></span>
<span><span class="co">#&gt; 1534: HD2022</span></span>
<span><span class="co">#&gt; 1535: HD2022</span></span>
<span><span class="co">#&gt; 1536: HD2022</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $pools</span></span>
<span><span class="co">#&gt;       group    phase  trial_type trial block_size        s1      s2    type</span></span>
<span><span class="co">#&gt;      &lt;char&gt;   &lt;char&gt;      &lt;char&gt; &lt;int&gt;      &lt;num&gt;    &lt;char&gt;  &lt;char&gt;  &lt;char&gt;</span></span>
<span><span class="co">#&gt;   1:    CB1 training  L&gt;(Pellet)     1          4  L,Pellet       L  combvs</span></span>
<span><span class="co">#&gt;   2:    CB1 training  L&gt;(Pellet)     1          4  L,Pellet  Pellet  combvs</span></span>
<span><span class="co">#&gt;   3:    CB1 training  L&gt;(Pellet)     1          4  L,Pellet       R  combvs</span></span>
<span><span class="co">#&gt;   4:    CB1 training  L&gt;(Pellet)     1          4  L,Pellet Sucrose  combvs</span></span>
<span><span class="co">#&gt;   5:    CB1 training R&gt;(Sucrose)     2          4 R,Sucrose       L  combvs</span></span>
<span><span class="co">#&gt;  ---                                                                       </span></span>
<span><span class="co">#&gt; 764:    CB2 training          #L    47          4         L Sucrose chainvs</span></span>
<span><span class="co">#&gt; 765:    CB2 training          #R    48          4         R       L chainvs</span></span>
<span><span class="co">#&gt; 766:    CB2 training          #R    48          4         R  Pellet chainvs</span></span>
<span><span class="co">#&gt; 767:    CB2 training          #R    48          4         R       R chainvs</span></span>
<span><span class="co">#&gt; 768:    CB2 training          #R    48          4         R Sucrose chainvs</span></span>
<span><span class="co">#&gt;      value  model</span></span>
<span><span class="co">#&gt;      &lt;num&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt;   1:     0 HD2022</span></span>
<span><span class="co">#&gt;   2:     0 HD2022</span></span>
<span><span class="co">#&gt;   3:     0 HD2022</span></span>
<span><span class="co">#&gt;   4:     0 HD2022</span></span>
<span><span class="co">#&gt;   5:     0 HD2022</span></span>
<span><span class="co">#&gt;  ---             </span></span>
<span><span class="co">#&gt; 764:     0 HD2022</span></span>
<span><span class="co">#&gt; 765:     0 HD2022</span></span>
<span><span class="co">#&gt; 766:     0 HD2022</span></span>
<span><span class="co">#&gt; 767:     0 HD2022</span></span>
<span><span class="co">#&gt; 768:     0 HD2022</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $responses</span></span>
<span><span class="co">#&gt;        group    phase trial_type trial block_size      s1      s2 value  model</span></span>
<span><span class="co">#&gt;       &lt;char&gt;   &lt;char&gt;     &lt;char&gt; &lt;int&gt;      &lt;num&gt;  &lt;char&gt;  &lt;char&gt; &lt;num&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt;    1:    CB1 training L&gt;(Pellet)     1          4       L       L     0 HD2022</span></span>
<span><span class="co">#&gt;    2:    CB1 training L&gt;(Pellet)     1          4       L  Pellet     0 HD2022</span></span>
<span><span class="co">#&gt;    3:    CB1 training L&gt;(Pellet)     1          4       L       R     0 HD2022</span></span>
<span><span class="co">#&gt;    4:    CB1 training L&gt;(Pellet)     1          4       L Sucrose     0 HD2022</span></span>
<span><span class="co">#&gt;    5:    CB1 training L&gt;(Pellet)     1          4  Pellet       L     0 HD2022</span></span>
<span><span class="co">#&gt;   ---                                                                         </span></span>
<span><span class="co">#&gt; 1532:    CB2 training         #R    48          4       R Sucrose     0 HD2022</span></span>
<span><span class="co">#&gt; 1533:    CB2 training         #R    48          4 Sucrose       L     0 HD2022</span></span>
<span><span class="co">#&gt; 1534:    CB2 training         #R    48          4 Sucrose  Pellet     0 HD2022</span></span>
<span><span class="co">#&gt; 1535:    CB2 training         #R    48          4 Sucrose       R     0 HD2022</span></span>
<span><span class="co">#&gt; 1536:    CB2 training         #R    48          4 Sucrose Sucrose     0 HD2022</span></span></code></pre></div>
<p>Although <code><a href="../reference/CalmrExperiment-methods.html">results()</a></code> returns many model outputs, as I said
earlier, we only care about one of them: <code>responses</code> (the
model responses). With them, we can write our model function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_model_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">exper</span>, <span class="va">full</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># extract the parameters from the model</span></span>
<span>  <span class="va">new_parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CalmrExperiment-methods.html">parameters</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="co"># assign alphas</span></span>
<span>  <span class="va">new_parameters</span><span class="op">$</span><span class="va">alphas</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pars</span></span>
<span>  <span class="co"># reassign parameters to the experiment</span></span>
<span>  <span class="fu"><a href="../reference/CalmrExperiment-methods.html">parameters</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">new_parameters</span> <span class="co"># note parameters method</span></span>
<span>  <span class="co"># running the model and selecting responses</span></span>
<span>  <span class="va">exp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">exper</span><span class="op">)</span></span>
<span>  <span class="co"># summarizing the model</span></span>
<span>  <span class="va">responses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CalmrExperiment-methods.html">results</a></span><span class="op">(</span><span class="va">exp_res</span><span class="op">)</span><span class="op">$</span><span class="va">responses</span></span>
<span>  <span class="co"># calculate extra variables</span></span>
<span>  <span class="va">responses</span><span class="op">$</span><span class="va">response</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">responses</span><span class="op">$</span><span class="va">s1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pellet"</span>, <span class="st">"Sucrose"</span><span class="op">)</span>,</span>
<span>    <span class="st">"np"</span>, <span class="st">"lp"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">responses</span><span class="op">$</span><span class="va">block</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">responses</span><span class="op">$</span><span class="va">trial</span> <span class="op">/</span> <span class="fl">8</span><span class="op">)</span></span>
<span>  <span class="co"># filtering</span></span>
<span>  <span class="co"># only probe trials</span></span>
<span>  <span class="va">responses</span> <span class="op">&lt;-</span> <span class="va">responses</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"#"</span>, <span class="va">trial_type</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="co"># only available responses</span></span>
<span>  <span class="va">responses</span> <span class="op">&lt;-</span> <span class="va">responses</span><span class="op">[</span><span class="va">s2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pellet"</span>, <span class="st">"Sucrose"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">(</span><span class="va">response</span> <span class="op">==</span> <span class="st">"np"</span> <span class="op">|</span> <span class="op">(</span><span class="va">response</span> <span class="op">==</span> <span class="st">"lp"</span> <span class="op">&amp;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">grepl</span>, <span class="va">s1</span>, <span class="va">trial_type</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="co"># aggregate</span></span>
<span>  <span class="va">responses</span> <span class="op">&lt;-</span> <span class="va">responses</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"block"</span>, <span class="st">"s2"</span>, <span class="st">"response"</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">full</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">responses</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">responses</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s dissect the function above in its three parts.</p>
<ol style="list-style-type: decimal">
<li><p>We get the parameters from the experiment, via the
<code><a href="../reference/CalmrExperiment-methods.html">parameters()</a></code> method and store them in
<code>new_parameters</code>.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Note the &lt;code&gt;[[1]]&lt;/code&gt; to get the first parameter
lists; by default, &lt;code&gt;parameters&lt;/code&gt; returns a named list after
each group&lt;/p&gt;"><sup>1</sup></a></p></li>
<li><p>We put <code>pars</code> (the parameters provided by the
optimizer) into the <code>alphas</code> of
<code>new_parameters</code>.</p></li>
<li><p>We run the experiment and store it in
<code>exp_res</code>.</p></li>
<li><p>We select the model responses (<code>responses</code>) from the
model results and store them in <code>responses</code>.</p></li>
<li><p>Lastly. We summarise the model responses and return them.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Within this step, we also filter all output nodes that
are not related to expecting one of the USs, we classify responses as
being nosepokes (produced by the food reward) or lever presses (produced
by the levers), and calculate the mean across blocks of trials. Fitting
a model is no trivial task!&lt;/p&gt;"><sup>2</sup></a></p></li>
</ol>
<p>That’s a lot to digest, so let’s see the function in action.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">my_model_function</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.2</span>, <span class="fl">.4</span>, <span class="fl">.3</span><span class="op">)</span>, <span class="va">experiment</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 0.028557609 0.040188221 0.004008696 0.008429327 0.045573899 0.061933782</span></span>
<span><span class="co">#&gt;  [7] 0.010480790 0.021230102 0.053426837 0.070862133 0.015100913 0.029677071</span></span>
<span><span class="co">#&gt; [13] 0.057584182 0.074995358 0.018328387 0.035165746 0.059994400 0.077081202</span></span>
<span><span class="co">#&gt; [19] 0.020711121 0.039013071 0.061492438 0.078227391 0.022547790 0.041891069</span></span></code></pre></div>
<p>Just numbers!</p>
<p>The order of the empirical data and model responses must match. I
cannot emphasize this point enough: there is nothing within the fit
function that checks or reorders the data for you.</p>
<p>You are the sole responsible for making sure both of these pieces of
data are in the same order. A simple way would be to print the model
results before the return and compare them against the data. That’s the
reason for the <code>full</code> parameter in the function
definition.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">my_model_function</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.2</span>, <span class="fl">.4</span>, <span class="fl">.3</span><span class="op">)</span>, <span class="va">experiment</span>, full <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    block      s2 response       value</span></span>
<span><span class="co">#&gt;    &lt;num&gt;  &lt;char&gt;   &lt;char&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     1  Pellet       lp 0.028557609</span></span>
<span><span class="co">#&gt; 2:     1 Sucrose       lp 0.040188221</span></span>
<span><span class="co">#&gt; 3:     1  Pellet       np 0.004008696</span></span>
<span><span class="co">#&gt; 4:     1 Sucrose       np 0.008429327</span></span>
<span><span class="co">#&gt; 5:     2  Pellet       lp 0.045573899</span></span>
<span><span class="co">#&gt; 6:     2 Sucrose       lp 0.061933782</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pati_summ</span><span class="op">)</span></span>
<span><span class="co">#&gt;    block     us response     rpert</span></span>
<span><span class="co">#&gt;    &lt;num&gt; &lt;char&gt;   &lt;fctr&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     1      P       lp 0.8195313</span></span>
<span><span class="co">#&gt; 2:     1      S       lp 0.5609375</span></span>
<span><span class="co">#&gt; 3:     1      P       np 3.4109375</span></span>
<span><span class="co">#&gt; 4:     1      S       np 3.2796875</span></span>
<span><span class="co">#&gt; 5:     2      P       lp 1.5738281</span></span>
<span><span class="co">#&gt; 6:     2      S       lp 0.6406250</span></span></code></pre></div>
<p>Once we have made sure everything is looking good, we can fit the
model.</p>
</div>
<div class="section level3">
<h3 id="fitting-the-model">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h3>
<p>We fit models using the <code><a href="../reference/fit_model.html">fit_model()</a></code> function. This
function requires 4 arguments:</p>
<ol style="list-style-type: decimal">
<li>The (empirical) data.</li>
<li>A model function.</li>
<li>The arguments with which to run the model function.</li>
<li>The optimizer options.</li>
</ol>
<p>We have done a great job taking care of the first three, so let’s
tackle the last.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_optimizer_opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_optimizer_opts.html">get_optimizer_opts</a></span><span class="op">(</span></span>
<span>  model_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">$</span><span class="va">alphas</span><span class="op">)</span>,</span>
<span>  optimizer <span class="op">=</span> <span class="st">"ga"</span>,</span>
<span>  ll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  ul <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"normal"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">my_optimizer_opts</span></span>
<span><span class="co">#&gt; $model_pars</span></span>
<span><span class="co">#&gt; [1] "L"       "Pellet"  "R"       "Sucrose"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $optimizer</span></span>
<span><span class="co">#&gt; [1] "ga"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $family</span></span>
<span><span class="co">#&gt; [1] "normal"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $family_pars</span></span>
<span><span class="co">#&gt; [1] "normal_scale"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $all_pars</span></span>
<span><span class="co">#&gt; [1] "L"            "Pellet"       "R"            "Sucrose"      "normal_scale"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $initial_pars</span></span>
<span><span class="co">#&gt; [1] NA NA NA NA  1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ll</span></span>
<span><span class="co">#&gt;            L       Pellet            R      Sucrose normal_scale </span></span>
<span><span class="co">#&gt;            0            0            0            0            0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ul</span></span>
<span><span class="co">#&gt;            L       Pellet            R      Sucrose normal_scale </span></span>
<span><span class="co">#&gt;            1            1            1            1          100 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $verbose</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>The <code><a href="../reference/get_optimizer_opts.html">get_optimizer_opts()</a></code> function returns many
things:</p>
<ol style="list-style-type: decimal">
<li>model_pars: The name of the model parameters (name of the alpha for
each stimulus).</li>
<li>ll and ul: The lower and upper limits for the parameter search.</li>
<li>optimizer: The numerical optimization technique we wish to use
during MLE estimation.</li>
<li>family: The family distribution we assume for our model. In
practice, what you request here will be used to determine the link
function to transform model responses, and the likelihood function used
in the objective function. The normal family here does nothing fancy to
the model responses but will estimate an extra parameter, scale, which
scales the model responses into the scale of the empirical data. When it
comes to likelihood functions, this family will use the normal density
of the data and model differences.</li>
<li>family_pars: The family-specific parameter being estimated alongside
salience parameters.</li>
<li>verbose: Whether to print parameters and objective function values
as we optimize.</li>
</ol>
<p>You are free to modify these; just make sure the structure of the
list returned by <code><a href="../reference/get_optimizer_opts.html">get_optimizer_opts()</a></code> remains the same.</p>
<p>We can also pass extra parameters to the optimizer call we are using
(e.g., the <code>par</code> argument for <code>optim</code>, or
<code>parallel</code> for <code>ga</code>). Here, we fit the model in
parallel with <code>ga</code>, and for only 10 iterations.</p>
<p>And with that, we can fit the model! (be patient if you are following
along)</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">the_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span><span class="va">pati_summ</span><span class="op">$</span><span class="va">rpert</span>,</span>
<span>  model_function <span class="op">=</span> <span class="va">my_model_function</span>,</span>
<span>  exper <span class="op">=</span> <span class="va">experiment</span>,</span>
<span>  optimizer_options <span class="op">=</span> <span class="va">my_optimizer_opts</span>,</span>
<span>  maxiter <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>fit_model</code> function returns a lot of information to
track what we put in and what we got out. However, typing the model in
the console will show the MLE parameters we obtained this time and their
negative log-likelihood, given the data:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">the_fit</span></span>
<span><span class="co"># the BIC and AIC</span></span>
<span><span class="fu"><a href="../reference/CalmrFit-methods.html">BIC</a></span><span class="op">(</span><span class="va">the_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 102.484</span></span>
<span><span class="fu"><a href="../reference/CalmrFit-methods.html">AIC</a></span><span class="op">(</span><span class="va">the_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 96.5937</span></span></code></pre></div>
<p>That’s good and all, but how well does a model run with those
parameters “visually” fit the data? We can obtain the predictions from
the model via the <code>predict</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pati_summ</span><span class="op">$</span><span class="va">prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CalmrFit-methods.html">predict</a></span><span class="op">(</span><span class="va">the_fit</span>, exper <span class="op">=</span> <span class="va">experiment</span><span class="op">)</span></span>
<span><span class="va">pati_summ</span><span class="op">[</span>, <span class="va">data</span> <span class="op">:=</span> <span class="va">rpert</span><span class="op">]</span><span class="op">[</span>, <span class="va">rpert</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span><span class="va">pati_summ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">pati_summ</span>, measure.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prediction"</span>, <span class="st">"data"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pati_summ</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">block</span>, y <span class="op">=</span> <span class="va">value</span>,</span>
<span>    colour <span class="op">=</span> <span class="va">us</span>,</span>
<span>    linetype <span class="op">=</span> <span class="va">variable</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">us</span> <span class="op">~</span> <span class="va">response</span><span class="op">)</span></span></code></pre></div>
<p><img src="calmr_fits_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>This looks pretty good! Save from some blatant misfits, of
course.</p>
<p>Now you know everything you need to fit <code>calmr</code> to your
empirical data. Go forth!</p>
<div class="section level4">
<h4 id="a-final-note">A final note<a class="anchor" aria-label="anchor" href="#a-final-note"></a>
</h4>
<p>This vignette was pre-generated, as I don’t want the user to fit the
model at the time of installation. I will try to keep up with it as the
package develops, but if you spot any inconsistencies, please drop me a
line.</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Victor Navarro.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
